<dom-module>
    <style>
        .popover-sub-item > div {
            background-color: rgb(103, 177, 100);
        }
        
        iron-collapse > app-items > div {
            background-color: #4caf50;
            color: white !important;
        }
        
        .popover-item > div {
            background-color: #4caf50;
            color: white !important;
        }
    </style>
    <template id="app-icon-button">
        <paper-icon-button on-click="toggltMenu" icon="{{icon}}"></paper-icon-button>
        <app-popover id="menu" direction="bottom">
            <iron-overlay-backdrop on-click="outfield"></iron-overlay-backdrop>
            <app-items class="popover-item" on-click="changeStatus" name="修改狀態"></app-items>
            <iron-collapse on-click="sendChange" id="changeStatus">
                <app-items class="popover-sub-item" name="可借"></app-items>
                <app-items class="popover-sub-item" name="借出"></app-items>
                <app-items class="popover-sub-item" name="停借"></app-items>
                <app-items class="popover-sub-item" name="損壞"></app-items>
            </iron-collapse>
            <app-items class="popover-item" on-click="changeName" name="修改名稱"></app-items>
            <iron-collapse id="changeName">
                <paper-input style="background-color: rgb(103, 177, 100);" label="器材名稱"></paper-input>
            </iron-collapse>
        </app-popover>
        <iron-ajax verbose url="../Rear/changeStatus.php" method="POST" params='' handle-as="json" on-response="handleResponse" debounce-duration="300"></iron-ajax>
    </template>
    <script>
        Polymer({
            is: 'app-icon-button',
            properties: {
                icon: String
            },
            behavier: [Polymer.PaperButtonBehavior],
            ready: function () {
                this.querySelector("iron-overlay-backdrop").prepare();
            },
            toggltMenu: function () {
                this.$.menu.toggle();
            },
            changeStatus: function () {
                this.$.changeStatus.toggle();
            },
            changeName: function (e) {
                this.$.changeName.toggle();
            },
            outfield: function () {
                this.$.menu.hide();
            },
            sendChange: function (e) {
                var targetBtnValue = e.path[1].name,
                    ajax = this.$$("iron-ajax");
                ajax.generateRequest();
            },
            handleResponse: function () {
                console.log(this.$$("iron-ajax").lastResponse);
            }
        });
    </script>
</dom-module>